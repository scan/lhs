rspec:
  name: 'RSPec tests'

  run-on:
    - type: branch
      include-match: ^.*$

  context:
    task_defaults:
      ports:
        CAPYBARA_PORT:
          inet_address: "localhost"
          min: 8000
          max: 8999
        PHANTOMJS_PORT:
          inet_address: "localhost"
          min: 44600
          max: 44999

      scripts:
        rspec:
          start-when:
            - script: bundle
            - script: tmp-cache

        include:
          - cider-ci/scripts/ruby.yml
          - cider-ci/scripts/bundle.yml
          - cider-ci/scripts/tmp-cache.yml

      trial-attachments:
        logs:
          include-match: log\/.*\.log$
          content-type: text/plain
        image-screenshots:
          include-match: tmp\/capybara\/.*\.png$
          content-type: image/png
        html-screenshots:
          include-match: tmp\/capybara\/.*\.html$
          content-type: text/html

    generate_tasks:
      include_match: spec/.*_spec.rb
      exclude_match: spec/support/shared/*
